<!-- Code from d3-graph-gallery.com -->
<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>
<script type="module" src="./bubbles.js"></script>

<!-- Create a div where the graph will take place -->
<div>
<label for="dpt_select">Select a Department: </label>
<select name="department" id="dpt_select">
    <option value="bolivar">Bolivar</option>
    <option value="vichada">Vichada</option>
    <option value="sucre">Sucre</option>
    <option value="amazonas">Amazonas</option>
    <option value="huila">Huila</option>
    <option value="cordoba">Cordoba</option>
    <option value="cesar">Cesar</option>
    <option value="putumayo">Putymayo</option>
    <option value="norte_de_santander">Norte de Santander</option>
    <option value="cauca">Cauca</option>
    <option value="bogota_dc">Bogota DC</option>
    <option value="la_guajira">La Guajira</option>
    <option value="antioquia">Antioquia</option>
    <option value="narino">Narino</option>
    <option value="meta">Meta</option>
    <option value="magdalena">Magdalena</option>
    <option value="cundinamarca">Cundinamarca</option>
    <option value="vaupes">Vaupes</option>
    <option value="atlantico">Atlantico</option>
    <option value="valle_del_cauca">Valle del Cauca</option>
    <option value="boyaca">Boyaca</option>
    <option value="tolima">Tolima</option>
    <option value="risaralda">Risaralda</option>
    <option value="quindio">Quindio</option>
    <option value="casanare">Casanare</option>
    <option value="arauca">Arauca</option>
    <option value="caldas">Caldas</option>
    <option value="choco">Choco</option>
    <option value="santander">Santander</option>
    <option value="caqueta">Caqueta</option>
    <option value="archipielago_de_san_andres">Archipielago de San Andres</option>
</select>
    <label for="color_select">Select a Hue Variable: </label>
    <select name="hue" id="color_select">
        <option value="cari">CARI Score</option>
        <option value="gov_aid">Governemnt Aid</option>
    </select>
</div>
<div id="my_dataviz"></div>
<script type="module">
    import {BubbleChart} from "./bubbles.js";
    // load the data
    update_bubble_chart("bolivar")

    function update_bubble_chart(dpt_name) {
        var plot_data = [];
        d3.csv("data_files/by_department/"+ dpt_name + "_clean_dataset.csv", function (data) {
            for (var i = 0; i < data.length; i++) {
                plot_data.push({"size": data[i].household_size, "aid": data[i].government_assistance, "group": Math.round(data[i].cari)})
            }
            console.log(plot_data)
            document.getElementById("my_dataviz").innerHTML = "";
            var svg = d3.select("svg");
            svg.selectAll("*").remove();
            let BC = new BubbleChart("#my_dataviz", 1000, 700)
            BC.initialize_nodes(plot_data)
        });
    }

    document.getElementById('dpt_select').addEventListener('change', function() {
        update_bubble_chart(this.value)
    });

    document.getElementById('color_select').addEventListener('change', function() {
        update_bubble_chart(document.getElementById('dpt_select').value)
    });
</script>