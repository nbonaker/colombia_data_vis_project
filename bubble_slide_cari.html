<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
  <head>
    <meta charset="UTF-8" />
    <title>ðŸš©s of Colombia</title>
    <!-- Load d3.js -->
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script type="module" src="bubbles_cari.js"></script>
    <link rel="stylesheet" href="main_stylesheet.css" />
  </head>
  <style>
    .bubble-box {
      /* background-color: white; */
      background-clip: content-box;
      /* border-radius: 20px; */
      width: 63%;
      height: 100%;
      display: table-cell;
      border-right: 1px solid #b6b6b6;
      margin-right: 5px;
      padding-right: 5px;
    }
    .description-box {
      background-color: white;
      background-clip: content-box;
      border-radius: 20px;
      width: 30%;
      height: 100%;
      display: table-cell;
      padding-left: 5px;
      vertical-align: top;
    }
    .description-box-text {
      display: block;
      width: 95%;
      height: 95%;
      padding-left: 5%;
      padding-top: 5%;
    }
  </style>
  <body>
    <div class="title-box">
      <div class="title-box-text">Food Insecurity in the Population</div>
    </div>

    <div class="content-container">
      <div style="display: table-row; padding: 10px">
        <div style="height: 100%; display: table-cell">
          <div class="vertical-center">
            <a id="back_button" href="" target="_self">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="100%"
                fill="#aaaaaa"
                class="bi bi-chevron-compact-left"
                viewBox="0 0 16 16"
              >
                <path
                  fill-rule="evenodd"
                  d="M9.224 1.553a.5.5 0 0 1 .223.67L6.56 8l2.888 5.776a.5.5 0 1 1-.894.448l-3-6a.5.5 0 0 1 0-.448l3-6a.5.5 0 0 1 .67-.223z"
                />
              </svg>
            </a>
          </div>
        </div>
        <div class="bubble-box">
          <div id="bubble-graph"></div>
        </div>
        <div class="description-box">
          <div class="description-box-text">
            <h3>27% of the population is currently food insecure.</h3>
            <p>
              They aren't getting enough food to be able to fulfill the
              necessary nutritional requirements to live a healthy life.
            </p>
            <p>
              Additionally, only 14% of the population is truly food secure.
            </p>
            <p>
              For the other 59% of the population, there are a variety of
              unsustainable methods that are being used to get enough food.
              These include selling items from their house, using life savings,
              or going into debt. For these people, extended time without
              assistance or an unforseen shock to the financial situation could
              result in a mass movement of people to food insecurity.
            </p>

            <h3>Legend:</h3>
            <p>
              Each bubble represents approximately 100,000 people in Colombia.
              Bubbles are split to show the relative proportion of the total
              Colombian population in each food security category.
            </p>
            <p>
              <svg height="20" width="20">
                <circle
                  cx="10"
                  cy="10"
                  r="9"
                  stroke="black"
                  stroke-width="2"
                  fill="#cb0f00"
                />
              </svg>
              <b>Severe Food Insecurity:</b> Has extreme food consumption gaps
            </p>
            <p>
              <svg height="20" width="20">
                <circle
                  cx="10"
                  cy="10"
                  r="9"
                  stroke="black"
                  stroke-width="2"
                  fill="#ff746c"
                />
              </svg>
              <b>Moderate Food Insecurity:</b> Has food consumption gaps and are
              unable to meet required food needs
            </p>
            <p>
              <svg height="20" width="20">
                <circle
                  cx="10"
                  cy="10"
                  r="9"
                  stroke="black"
                  stroke-width="2"
                  fill="#24c6f3"
                />
              </svg>
              <b>Marginal Food Security</b> Has minimally inadequate food
              consumption
            </p>
            <p>
              <svg height="20" width="20">
                <circle
                  cx="10"
                  cy="10"
                  r="9"
                  stroke="black"
                  stroke-width="2"
                  fill="#0443a6"
                />
              </svg>
              <b>Food Security:</b> Able to meet food needs
            </p>
            <p>
              <a style="color: #064a7a; font-style: italic"
                 href="https://docs.wfp.org/api/documents/WFP-0000134704/download/"  target="_blank">
                Learn more about how the WFP categorizes food security
              </a>
            </p>
          </div>
        </div>
        <div style="height: 100%; display: table-cell">
          <div class="vertical-center">
            <a id="next_button" href="" target="_self">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="100%"
                fill="#aaaaaa"
                class="bi bi-chevron-compact-right"
                viewBox="0 0 16 16"
              >
                <path
                  fill-rule="evenodd"
                  d="M6.776 1.553a.5.5 0 0 1 .671.223l3 6a.5.5 0 0 1 0 .448l-3 6a.5.5 0 1 1-.894-.448L9.44 8 6.553 2.224a.5.5 0 0 1 .223-.671z"
                />
              </svg>
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="timeline-contain">
      <a href="./intro_map.html" target="_self" class="timeline-button-before"
        >Introduction</a
      >
      <a href="./bubble_slide_cari.html" target="_self" class="timeline-button-before"
        >Food Insecurity</a
      >
      <a href="./cari_by_department.html" target="_self" class="timeline-button"
        >Insecurity by Department</a
      >
      <a href="./beeswarm_example.html" target="_self" class="timeline-button"
        >Food Expenditures</a
      >
      <a
        href="./beeswarm_example_noaid.html"
        target="_self"
        class="timeline-button"
        >Insecurity and Aid</a
      >
      <a
        href="./bubble_slide_gov_aid.html"
        target="_self"
        class="timeline-button"
        >Government Aid</a
      >
      <a href="aid_by_department.html" target="_self" class="timeline-button"
        >Department Aid</a
      >
      <a href="./red_flags_map.html" target="_self" class="timeline-button"
        >Red Flags Map</a
      >
      <a
        href="./bubbles_action_call.html"
        target="_self"
        class="timeline-button"
      >
        Future Step
      </a>
    </div>

    <script type="module">
      import { BubbleChart } from "./bubbles_cari.js";
      // load the data
      update_bubble_chart();

      // resizes the bubble chart when resizing event finishes (prevents jittering)
      var resize_delay;
      window.onresize = function () {
        clearTimeout(resize_delay);
        resize_delay = setTimeout(update_bubble_chart, 100);
      };

      function update_bubble_chart() {
        var plot_data = [];
        d3.csv("data_files/food_insecurity_bubble_data.csv", function (data) {
          for (var i = 0; i < data.length; i++) {
            plot_data.push({ size: 100, group: Math.round(data[i].cari) });
          }
          console.log(plot_data);
          document.getElementById("bubble-graph").innerHTML = "";
          // var svg = d3.select("svg");
          // svg.selectAll("*").remove();

          let box = document.querySelector(".bubble-box");
          let width = box.clientWidth;
          let height = box.clientHeight*0.9;
          let BC = new BubbleChart("#bubble-graph", width, height, "cari");
          BC.initialize_nodes(plot_data);
        });
      }

      // URL PARAMETERS
      function updateTimelinelinks(param_str) {
        var buttons_before = document.querySelectorAll(".timeline-button-before");
        var buttons_after = document.querySelectorAll(".timeline-button");

        for (var i = 0; i < buttons_before.length; i++) {
          var button = buttons_before[i]
          var cur_href_no_params = button.href.split("?")[0]
          button.setAttribute("href", cur_href_no_params + param_str);
        }

        for (var i = 0; i < buttons_after.length; i++) {
          var button = buttons_after[i]
          var cur_href_no_params = button.href.split("?")[0]
          button.setAttribute("href", cur_href_no_params + param_str);
        }
      }

      const queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString);
      const dpt_select = urlParams.get("dpt");

      var back_url = "./intro_map.html";
      var next_url = "./cari_by_department.html";
      if (!!dpt_select) {
        back_url = back_url + "?dpt=" + dpt_select;
        next_url = next_url + "?dpt=" + dpt_select;
        updateTimelinelinks("?dpt=" + dpt_select);
      }

      document.getElementById("back_button").href = back_url;
      document.getElementById("next_button").href = next_url;


    </script>
  </body>
</html>
